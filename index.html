<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>首页</title>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="package/bootstrapvalidator-master/dist/css/bootstrapValidator.min.css">
    
</head>
<body>

    <!-- 头部导航栏开始 -->
    <div class="header">
        <div class="banxin">
            <img src="img/未标题-10.png" class="logo" alt="">
            <ul>
                <li><a href="">首页</a></li>
                <li><a href="calssify.html">课程</a></li>
                <li><a href="">院校</a></li>
                <li><a href="">立体教材</a></li>
            </ul>
            <div class="search">
                <img class="searchicon" src="img/未标题-1.png" ></img>
                <input class="searchinput" type="text" placeholder="搜索课程或学校">
            </div>
            <div class="login">
                <img class="loginicon" src="img/未标题-2.png"></img>
                <!-- 这里的模态框用js实现 -->
                <div class="register" data-toggle="modal" data-target="#myModal">注册</div>
                <!-- 要显示新模态框，修改data-target中的ID就可以了 -->
                <div class="log" data-toggle="modal" data-target="#myModal1">登录</div>
            </div>
        </div>
    </div>
    <!-- 头部导航栏结束 -->
    <!-- 大轮播图开始 -->
    <div class="banner">
        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
                <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-example-generic" data-slide-to="1" ></li>
                <li data-target="#carousel-example-generic" data-slide-to="2" ></li>
                <li data-target="#carousel-example-generic" data-slide-to="3" ></li>
            </ol>
            
            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
                <div class="item active">
                        <img  src="img/banner1.jpg" alt="...">
                </div>
                <div class="item">
                        <img  src="img/banner2.jpg" alt="...">
                </div>
                <div class="item">
                        <img  src="img/banner3.jpg" alt="...">
                </div>
                <div class="item">
                        <img  src="img/banner4.jpg" alt="...">
                </div>
            </div>
        </div>

        <div class="banxin">
            <div class="catalogue">
                <ul class="box">

                </ul>
                <!-- 点击这个下一页重新渲染上面的分类 -->
                <div class="next">
                    下一页
                    
                </div>
            </div>
        </div>
    </div>
    <!-- 大轮播图结束 -->
    <!-- 课程列表开始 -->
    <div class="content">
        <div class="banxin">
            <div>
                <div class="headline">
                    <div class="line"></div>
                    <div class="font">热门课程</div>
                    <a href="" class="viewmore"> 查看更多</a>
                </div>
                <ul class="hot clearfix" >

                </ul>
            </div>
            <div>
                <div class="headline">
                    <div class="line"></div>
                    <div class="font">最新课程</div>
                    <a href="" class="viewmore"> 查看更多</a>
                </div>
                <ul  class="clearfix new">

                </ul>
            </div>
        </div>
    </div>
    <!-- 课程列表结束 -->
    <!-- 学校展示开始 -->
    <div class="school">
        <div class="banxin">
            <div>
                <div class="headline">
                    <div class="line"></div>
                    <div class="font">合作院校</div>
                    <a href="" class="viewmore"> 查看更多</a>
                </div>
                <ul class="nameofinstitution">

                </ul>
            </div>
        </div>
    </div>
    <!-- 学校展示结束 -->
    <!-- 公司信息开始 -->
    <div class="corporation">
        <div class="banxin friendfather">
            <ul class="friend">
                <li><a href="http://www.moe.gov.cn/"  target="_blank">中华人民共和国教育部</a></li>
                <li><a href="https://www.tech.net.cn/"  target="_blank">中国高职高专教育网</a></li>
                <li><a href="http://jpkc.shedu.net/" target="_blank">上海市中等职业学校精品课程平台</a></li>
                <li><a href="http://www.shedu.net.cn/shedu_new/main/xxzc.aspx"  target="_blank">上海职教在线</a></li>
                <li><a href="http://erchome.shedu.net/"  target="_blank">上海市职业教育中心</a></li>
            </ul>
            <div class="right">
                <div class="center">
                    <img src="img/未标题-8.png" alt=""> 
                    <div class="science">上海兰鸿信息科技有限公司</div>
                </div>
                <ul class="link">
                    <li><a href="">关于我们</a></li>
                    <li>|</li>
                    <li><a href="">联系我们</a></li>
                    <li>|</li>
                    <li><a href="">平台简介</a></li>
                    <li>|</li>
                    <li><a href="">知识产权</a></li>
                    <li>|</li>
                    <li><a href="">免责声明</a></li>
                </ul>
            </div>


        </div>

    </div>
    <!-- 公司信息结束 -->
    <!-- 底部开始 -->
    <div class="footer">
        <div class="banxin footerbanxin">
            <div class="footercenter">
                沪公网备案  *****号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COPYRIGHT © 2008-2012 兰鸿科技
            </div>
        </div>
    </div>
    <!-- 底部结束 -->
    <!-- 注册模态框开始 -->
      <!-- Modal -->
      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
              <div class="registertitle">
                    用户注册
              </div>
              <form id="registerform" name="register"  class="registerform" action="">
                  <div class="form-group">
                       
                        <input  name="telephoneemail" placeholder="输入邮箱或手机号" class="telephone" type="text">
                  </div>
                  <div class="form-group">
                        
                        <input name="username" placeholder="输入用户名" class="username" type="text">
                  </div>
                  <div class="form-group">
            
                        <input id="password" name="password" placeholder="输入密码" class="password" type="password">
                  </div>
                  <!-- <div class="nameexist">该用户名已存在</div> -->
                  <div class="registerbutton">立即注册</div>
                  <div class="elseregister">
                    <span>其它登录方式</span>  
                      <a href=""><img src="img/qq.png" alt=""></a>
                      <a href=""><img src="img/weixin.png" alt=""></a>
                      <a href=""><img  src="img/xinlang.png" alt=""></a>
                      <div class="nameexist">该用户名已存在</div>
                  </div>
              </form>
          </div>
        </div>
      </div>
    <!-- 注册模态框结束 -->
    <!-- 登录模态框开始 -->
    <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                    <div class="registertitle">
                            用户登录
                      </div>
                      <form class="registerform loginform" id="loginform" action="">
                          <div class="form-group">
                          <input  placeholder="输入用户名" name="username" class="telephone" type="text">
                          </div>
                          <div class="form-group">
                                <input placeholder="输入密码" name="password" class="username" type="password">
                          </div>

                          <div class="codefather clearfix">
                                <input  placeholder="输入验证码" name="code" class="code" type="text">
                                <img src="img/code.png" class="codeimg"></img>
                                <div class="check">换一张</div>
                                <div class="codeerr uperr">
                                    ⓧ 用户名或密码错误
                                </div>
                                <div class="codeerr cerr">
                                    ⓧ 验证码错误
                                </div>
                          </div>

                          <div class="loginbutton">立即登录</div>
                          <div class="else">

                            <div class="linkregister">注册</div>
                            <div class="forget">忘记密码</div>
                            <span>其它登录方式</span>  
        
                              
                             <a href=""><img src="img/qq.png" alt=""></a>
                             <a href=""> <img src="img/weixin.png" alt=""></a>
                             <a href=""><img  src="img/xinlang.png" alt=""></a>   
                          </div>
                      </form>
            </div>
        </div>
    </div>
    <!-- 登录模态框结束 -->
    <!-- 热门课程模板开始 -->
    <script id="hot" type="text/html">
        <% for(var i = 0 ; i < person.length ; i ++){%>
            <% var data = person[i] %>
            <li>
                <a href="<%= data.href%>">
                    <img class="courseimg" src="<%= data.src %>" alt="图片显示不了">
                    <div>
                        <div class="title"><%= data.title %> </div>
                        <div class="schoolname"><img class="imgicon" src="img/未标题-3.png" alt=""><span><%= data.shcoolname %></span></div>
                        <div class="schoolname"><img class="imgicon" src="img/未标题-4.png" alt=""><span><%= data.teacher %></span></div>
                        <div class="numberofpeople"><span><%= data.num %></span>人已报</div> 
                    </div>
                </a>
            </li>
        <%};%>

    </script>
    <!-- 热门课程模板结束 -->
    <!-- 最新课程模板开始 -->
    <script id="new" type="text/html">
        <% for(var i = 0 ; i < person.length ; i ++){%>
            <% var data = person[i] %>
            <li>
                <a href="<%= data.href%>">
                    <img class="courseimg" src="<%= data.src %>" alt="图片显示不了">
                    <div>
                        <div class="title"><%= data.title %> </div>
                        <div class="schoolname"><img class="imgicon" src="img/未标题-3.png" alt=""><span><%= data.shcoolname %></span></div>
                        <div class="schoolname"><img class="imgicon" src="img/未标题-4.png" alt=""><span><%= data.teacher %></span></div>
                        <div class="numberofpeople"><span><%= data.num %></span>人已报</div> 
                    </div>
                </a>
            </li>
        <%};%>
    </script>
    <!-- 最新课程模板结束 -->
    <!-- 轮播图开始 -->
    <!-- <script id="slideshow" type="text/html" >
        <% for(var i=0;i< person.length; i++){ %>
            <% var data = person[i] %>
            <% if(data.id == 1){ %>
            <div class="item active">
                    <img  src="<%= data.src %>" alt="...">
                </div>
            <% }else{ %>
                <div class="item">
                    <img  src="<%= data.src %>" alt="...">
                </div>
            <%}%>
        <% }; %>
    </script> -->

    <!-- 轮播图结束 -->
    <!-- 轮播图小圆点开始 -->
    <!-- <script id="slideshowdot" type="text/html" >
        <% for(var i=0 ; i < person.length; i++){ %>
            <% var data = person[i] %>
            <% if(data.id == 1){ %>
            <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
            <% }else{ %>
                <li data-target="#carousel-example-generic" data-slide-to="<%= data.id-1 %>"></li>
            <%}%>
        <%};%>
    </script> -->
    <!-- 轮播图小圆点结束 -->
    <!-- 分类的模板开始 -->
    <!-- <script id="classif" type="text/html" >

            <% for(var i = 0 ; i < arr.length; i ++){%>
                <% var data = arr[i] %>
            <a href="<%= data.href%>"><li><%= data.txt %></li></a>
            <%};%>

    </script> -->
    <!-- 分类的模板结束 -->

    <script id="classif" type="text/html" >
        <% if (arr.length-num>9){ %>
            <% for(var i = num ; i < num+9; i ++){%>
                <% var data = arr[i] %>
            <a href="<%= data.href%>"><li><%= data.txt %></li></a>
            <%};%>
        <%}else{%>
            <% for(var i = num ; i < arr.length; i ++){%>
                <% var data = arr[i] %>
            <a href="<%= data.href%>"><li><%= data.txt %></li></a>
            <%};%>     
        <%}%>
    </script>

    <!-- 学校的模板开始 -->
    <script id="schoolmodal" type="text/html">
        <% for(var i=0; i< person.length; i++){ %>
            <% var data = person[i] %>
            <li>
                <a href="<%= data.href %>">
                    <div class="images">
                        <img src="<%= data.src %>" alt="">
                        
                    </div>
                    <div class="name"><%= data.name %></div>
                </a>
            </li>
        <%}%>
    </script>
    <!-- 学校的模板结束 -->
</body>
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.min.js" ></script>
<script src="node_modules/art-template/lib/template-web.js" ></script>
<!-- <script src="node_modules/jquery-validation/dist/jquery.validate.js" ></script> -->
<!-- 用npm下载的bootstrapvalidator不能用，用git重新下载的 -->
<script src="package/bootstrapvalidator-master/dist/js/bootstrapValidator.min.js" ></script>
<script src="js/public.js" ></script>
<script src="js/index.js" ></script>
<!-- <script src="js/index.js" ></script> -->
<script>
    $(function(){
        // 点击下一页按钮的函数
        var click = 0;
        function clickNext(data){
            console.log(data);
            
            var shuzi = data.arr.length/9;
            
            // 如果超过了页数，就让页数重头开始
            if(click >= shuzi){
                click =0;
            }
            
            // 让页数从9的倍数开始
            data.num = click*9; 
            console.log(data);
            var htmlx = template("classif",data);
            $(".catalogue ul").html(htmlx);
            click++;
        }
        var data2 = {};
        // var arr = [];
    // 一开始ajax请求获取的分类数据，并渲染。
        // $.ajax({
        //     type:"GET",
        //     url:"http://localhost:3000/posts",
        //     dataType:"json",
        //     success:function(result){

                
            
        //         console.log(data2);
                
        //     },
        //     error:function(jqXHR){
        //         console.log("发生错误:"+jqXHR.status);
        //     }
        // });    
        result = [
                {href:"a",txt:"农林牧渔类"},
                {href:"a",txt:"资源环境类"},
                {href:"a",txt:"能源与新能源类"},
                {href:"a",txt:"土木水利类"},
                {href:"a",txt:"加工制造类"},
                {href:"a",txt:"石油化工类"},
                {href:"a",txt:"轻纺食品类"},
                {href:"a",txt:"交通运输类"},
                {href:"a",txt:"信息技术类"},

                {href:"a",txt:"农林牧渔类1"},
                {href:"a",txt:"资源环境类1"},
                {href:"a",txt:"能源与新能源类1"},
                {href:"a",txt:"土木水利类1"},
                {href:"a",txt:"加工制造类1"},
                {href:"a",txt:"石油化工类1"},
                {href:"a",txt:"轻纺食品类1"},
                {href:"a",txt:"交通运输类1"},
                {href:"a",txt:"信息技术类1"},

                {href:"a",txt:"信息技术类2"},
                {href:"a",txt:"土木水利类2"},
                {href:"a",txt:"加工制造类2"},
                {href:"a",txt:"农林牧渔类"},
                {href:"a",txt:"资源环境类"},
                {href:"a",txt:"能源与新能源类"},
                {href:"a",txt:"土木水利类"}];
                console.log(result);
                data2.arr = result;
            
        clickNext(data2)

    //单击下一页按钮
        $(".next").on("click",function(){
            clickNext(data2)
        })


        // 轮播图的数据获取
        // var data1 ={
        //     person: [
        //         {src: "img/banner1.jpg",id:1},
        //         {src: "img/banner2.jpg",id:2},
        //         {src: "img/banner3.jpg",id:3},
        //         {src: "img/banner4.jpg",id:4}
        //     ]
        // } 
        // var html1 = template("slideshow",data1);
        // $(".carousel-inner").html(html1);        
        // // 轮播图小圆点
        // var html2 = template("slideshowdot",data1);
        // $(".carousel-indicators").html(html2);      


        // 热门课程数据
        $.ajax({
            type:"GET",
            url:"http://localhost:3000/posts",
            dataType:"json",
            success:function(result){

                console.log(result);
                data = result
            },
            error:function(jqXHR){
                console.log("发生错误:"+jqXHR.status);
            }
        });    
            // 热门课程的数据和模板
        var data = {
            person:[
                {title:"jack",num:18,href:"l",src:"img/未标题-7.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
                {title:"ross",num:18,href:"m",src:"img/未标题-7.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
                {title:"tomer",num:18,href:"n",src:"img/未标题-7.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
                {title:"jerry",num:18,href:"o",src:"img/未标题-7.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
            ],
        };
        var html = template("hot",data);
        $(".hot").html(html);

        // 最新课程的数据
        $.ajax({
            type:"GET",
            url:"http://localhost:3000/posts",
            dataType:"json",
            success:function(result){

                console.log(result);
                datax = result
            },
            error:function(jqXHR){
                console.log("发生错误:"+jqXHR.status);
            }
        });    
            // 最新课程的数据和模板
        var datax = {
            person:[
                {title:"jack",num:18,href:"l",src:"img/未标题-9.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
                {title:"ross",num:18,href:"m",src:"img/未标题-9.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
                {title:"tomer",num:18,href:"n",src:"img/未标题-9.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
                {title:"jerry",num:18,href:"o",src:"img/未标题-9.png",shcoolname:"上海市城市科技学校",teacher: "王翠湖"},
            ],
        };

        var htmlz = template("new",datax);
        $(".new").html(htmlz);

        //学校的数据
        $.ajax({
            type:"GET",
            url:"http://localhost:3000/posts",
            dataType:"json",
            success:function(result){

                console.log(result);
                data3 = result
            },
            error:function(jqXHR){
                console.log("发生错误:"+jqXHR.status);
            }
        });    
        // 学校模板的渲染
        var data3 ={
            person :  [
                {href:"a",src:"img/未标题-12.png",name:"上海市城市科技学校"},
                {href:"a",src:"img/未标题-14.png",name:"上海市城市科技学校"},
                {href:"a",src:"img/未标题-12.png",name:"上海市城市科技学校"},
                {href:"a",src:"img/未标题-14.png",name:"上海市城市科技学校"},
                {href:"a",src:"img/未标题-12.png",name:"上海市城市科技学校"}
            ]
        }
        var html4 = template("schoolmodal",data3);
        $(".nameofinstitution").html(html4);



            // 在单击这个按钮时，如果没有验证通过就提示内容
            $('.registerbutton').on('click',function(){
                $('#registerform').data('bootstrapValidator').validate()
                // 如果在表单校验后出现错误提示，就监听form-group（也就是提示文字）的高度，变化了就改为原来的高度。
                if($('.form-group').height()>50){
                    $('.form-group').css({"height":'50px'});
                }
                $.ajax({
                    //几个参数需要注意一下
                        type: "POST",//方法类型
                        dataType: "json",//预期服务器返回的数据类型
                        url: "/users/login" ,//url
                        data: $('#registerform').serialize(),
                        success: function (result) {
                            console.log(result);//打印服务端返回的数据(调试用)
                            if (result.resultCode == 200) {
                            console.log("正常");
                            };
                            // 如果注册成功的话关闭模态框
                            modalhidden(".registerbutton","#myModal1");
                        },
                        error : function() {
                            console.log("失败");
                        }
                    });
            })

            // 登录表单的
            $('.loginbutton').on('click',function(){
            // 如果在表单校验后出现错误提示，就监听form-group（也就是提示文字）的高度，变化了就改为原来的高度。
            if($('.form-group').height()>50){
                console.log('aaaaaaaaaaa');
                $('.form-group').css({"height":'50px'});
                // $('.form-group .help-block').css({'margin-top':'-3px'})
            }
            console.log($('#loginform').serialize());
            
                $.ajax({
                    //几个参数需要注意一下
                        type: "POST",//方法类型
                        dataType: "json",//预期服务器返回的数据类型
                        url: "/users/login" ,//url
                        data: $('#loginform').serialize(),
                        success: function (result) {
                            console.log(result);//打印服务端返回的数据(调试用)
                            if (result.resultCode == 200) {
                                alert("SUCCESS");
                            };
                            // 如果登录成功的话关闭模态框
                            modalhidden(".loginbutton","#myModal1");
                        },
                        error : function() {
                            alert("异常！");
                        }
                    });
            })
            // 点击登录模态框中的注册
            $(".linkregister").on("click",function(){
                
                $("#myModal1").modal('hide')
                $(".register").click()
            })

            // 点击登录的时候发送请求。如果验证码错误返回一个值，如果用户名或密码错误返回另一个值，并控制报错信息显示。
            // 验证码错误与否
            $('.cerr').css({"display":"none"})
            // 用户名密码错误与否
            $('.uperr').css({"display":"none"})
            
            // 模态框居中
            modalCenter('#myModal')
            modalCenter('#myModal1')


            
            // 用input触发会有触发多次的问题，所以该为click
            $(".searchinput").on("click",function(){
            $(window).keyup(function(event){
                    if(event.which == 13) {
                        // 此处写ajax请求

                        console.log("向后台发请求"+$('.searchinput').val());
                        
                    }
                });
            })



            // 当搜索图标被单击后发送请求，并携带数据。
            $(".searchicon").on("click",function(){
                var val = $('.searchinput').val();
                // 此处写ajax请求

                console.log("被单击了"+val)

            })




    })


</script>
</html>