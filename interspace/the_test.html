<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>考试/测验-考试</title>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../package/bootstrapvalidator-master/dist/css/bootstrapValidator.min.css">
    <!--  导航栏的基本样式保证  -->
    <link rel="stylesheet" href="../css/teacherinterspace.css">
    <!--  左边栏样式保证  -->
    <link rel="stylesheet" href="../css/teacher_css/teacher_team.css">
    <!-- 提示框样式 -->
    <link href="../lib/toastr/toastr.min.css" type="text/css" rel="stylesheet">
    <!--  对话框样式  -->
    <link href="../lib/confirm/jquery-confirm.min.css" type="text/css" rel="stylesheet">
    <!--  课程图片上传样式  -->
    <link rel="stylesheet" href="../css/teacher_css/course_img.css">
    <link rel="stylesheet" href="../css/teacher_css/course_test.css">
</head>
<body>
<div class="maincontent">
    <!-- 头部导航栏开始 -->
    <div class="header">
        <div class="banxin">
            <img src="../img/未标题-10.png" class="logo" alt="">
            <ul>
                <li><a href="">首页</a></li>
                <li><a href="">课程</a></li>
                <li><a href="">院校</a></li>
                <li><a href="">立体教材</a></li>
            </ul>
            <div class="search">
                <img class="searchicon" src="../img/未标题-1.png" ></img>
                <input type="text" placeholder="搜索课程或学校">
            </div>
            <div class="login">
                <a href="">
                    <img class="loginicon" src="../img/未标题-2.png"></img>
                </a>
                <!-- 这里的模态框用js实现 -->
                <div class="register" data-toggle="modal" data-target="#myModal">注册</div>
                <!-- 要显示新模态框，修改data-target中的ID就可以了 -->
                <div class="log" data-toggle="modal" data-target="#myModal1">登录</div>
            </div>
        </div>
    </div>
    <!-- 头部导航栏结束 -->

    <!--  中间内容开始  -->
    <div class="tt_content">
        <!--  左边内容  -->
        <div class="tt_content_left">
            <form action="">
                <div class="headimg clearfix" >
                    <img  src="../images/kecheng.png" id="preview" class="headicon fl">
                    <div class="imgtitle ">
                        <input name="logo" type="file" id="filebtn" class="filebtn">
                    </div>
                </div>
            </form>
<!--            <img src="../images/kecheng1.png">-->
            <div class="tt_content_leftmenu">
                <a href="" class="introduction_href">课程简介</a>
                <a class="teacher_href" href="">教师团队</a>
                <a class="course_resources" href="" >课程资源</a>
                <a class="catalog_href" href="">课程目录</a>
                <a class="announcement_href" href="">系统公告</a>
                <a class="criteria_href" href="">评分表准</a>
                <a class="active test_href" href="">测验/考试</a>
                <a class="course_discussion" href="">讨论区</a>
                <a class="course_class" href="">班级</a>
                <a class="course_student" href="">学生</a>
                <a class="course_sum" href="">课程统计</a>
                <a class="course_study_sum" href="">学习统计</a>
            </div>
        </div>
        <!--  右边内容  -->
        <div class="tt_content_right">
            <div class="tt_content_right_title">
                考试/测验-考试
            </div>
            <!--  添加按钮  -->
            <div class="add_announcement_btn">
                <button onclick="new_detail()">新增考试</button>
            </div>
            <!--  没有数据时  -->
            <div class="no_data_tea">
                没有数据！……
            </div>
            <!--  公告主体内容  -->
            <div class="announcement_content">
                <div class="announcement_information">
                    <div class="announcement_btn">
                        <button>编辑</button>
                        <span>|</span>
                        <button>删除</button>
                    </div>
                    <div class="announcement_text">
                        <p>1、期中考试</p>
                        <p>考试总分： 100分</p>
                        <p>考试规定时间： 120分钟</p>
                        <p>考试起止日期： <span class="announcement_text_content">2019.2.01-201904.01</span></p>
                    </div>
                </div>
                <div class="announcement_information">
                    <div class="announcement_btn">
                        <button>编辑</button>
                        <span>|</span>
                        <button>删除</button>
                    </div>
                    <div class="announcement_text">
                        <p>1、期中考试</p>
                        <p>考试总分： 100分</p>
                        <p>考试规定时间： 120分钟</p>
                        <p>考试起止日期： <span class="announcement_text_content">2019.2.01-201904.01</span></p>
                    </div>
                </div>
                <div class="announcement_information">
                    <div class="announcement_btn">
                        <button>编辑</button>
                        <span>|</span>
                        <button>删除</button>
                    </div>
                    <div class="announcement_text">
                        <p>1、期中考试</p>
                        <p>考试总分： 100分</p>
                        <p>考试规定时间： 120分钟</p>
                        <p>考试起止日期： <span class="announcement_text_content">2019.2.01-201904.01</span></p>
                    </div>
                </div>
                <div class="announcement_information">
                    <div class="announcement_btn">
                        <button>编辑</button>
                        <span>|</span>
                        <button>删除</button>
                    </div>
                    <div class="announcement_text">
                        <p>1、期中考试</p>
                        <p>考试总分： 100分</p>
                        <p>考试规定时间： 120分钟</p>
                        <p>考试起止日期： <span class="announcement_text_content">2019.2.01-201904.01</span></p>
                    </div>
                </div>
            </div>
            <!--  分页  -->
            <div class="page_area">
                <ul id="page"></ul>
            </div>

        </div>

    </div>
    <!--  中间内容结束  -->

    <!-- 底部开始 -->
    <div class="footercontenter">
        <div class="footer">
            <div class="banxin footerbanxin">
                <div class="footercenter">
                    沪公网备案  *****号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COPYRIGHT © 2008-2012 兰鸿科技
                </div>
            </div>
        </div>
    </div>
    <!-- 底部结束 -->

</div>


<!-- 注册模态框开始 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="registertitle">
                用户注册
            </div>
            <form id="registerform" name="register"  class="registerform" action="">
                <div class="form-group">

                    <input  name="telephoneemail" placeholder="输入邮箱或手机号" class="telephone" type="text">
                </div>
                <div class="form-group">

                    <input name="username" placeholder="输入用户名" class="username" type="text">
                </div>
                <div class="form-group">

                    <input id="password" name="password" placeholder="输入密码" class="password" type="password">
                </div>
                <!-- <div class="nameexist">该用户名已存在</div> -->
                <div class="registerbutton">立即注册</div>
                <div class="elseregister">
                    <span>其它登录方式</span>
                    <a href=""><img src="../img/qq.png" alt=""></a>
                    <a href=""><img src="../img/weixin.png" alt=""></a>
                    <a href=""><img  src="../img/xinlang.png" alt=""></a>
                    <div class="nameexist">该用户名已存在</div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- 注册模态框结束 -->
<!-- 登录模态框开始 -->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="registertitle">
                用户登录
            </div>
            <form class="registerform loginform" id="loginform" action="">
                <div class="form-group">
                    <input  placeholder="输入用户名" name="username" class="telephone" type="text">
                </div>
                <div class="form-group">
                    <input placeholder="输入密码" name="password" class="username" type="password">
                </div>

                <div class="codefather clearfix">
                    <input  placeholder="输入验证码" name="code" class="code" type="text">
                    <img src="../img/code.png" class="codeimg"></img>
                    <div class="check">换一张</div>
                    <div class="codeerr uperr">
                        ⓧ 用户名或密码错误
                    </div>
                    <div class="codeerr cerr">
                        ⓧ 验证码错误
                    </div>
                </div>

                <div class="loginbutton">立即登录</div>
                <div class="else">

                    <div class="linkregister">注册</div>
                    <div class="forget">忘记密码</div>
                    <span>其它登录方式</span>


                    <a href=""><img src="../img/qq.png" alt=""></a>
                    <a href=""> <img src="../img/weixin.png" alt=""></a>
                    <a href=""><img  src="../img/xinlang.png" alt=""></a>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- 登录模态框结束 -->
<!-- 编辑模态框 -->
<div class="modal fade" id="detail_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 100%; height: auto">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">详情/编辑</h4>
            </div>
            <form class="form-horizontal adminex-form" id="detail_form" action="javascript: update_test()" >
                <div class="modal-body">
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">ID</label>
                        <div class="col-sm-6">
                            <input class="form-control id" name="id" type="text" placeholder="id" disabled />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">标题</label>
                        <div class="col-sm-6">
                            <input class="form-control title" name="title" type="text" placeholder="请输入标题" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">总分</label>
                        <div class="col-sm-6">
                            <input class="form-control count" name="count" type="text" placeholder="请输入总分" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">考试时长</label>
                        <div class="col-sm-6">
                            <input class="form-control gtime" name="gtime" type="text" placeholder="请输入时长" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">开始时间</label>
                        <div class="col-sm-6">
                            <input class="form-control time" name="time" type="date" placeholder="请输入开始时间" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">结束时间</label>
                        <div class="col-sm-6">
                            <input class="form-control data" name="data" type="date" placeholder="请输入结束时间" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <input type="submit" class="btn btn-primary" value="保存" />
                </div>
            </form>
        </div>
    </div>
</div>
<!-- 新增模态框 -->
<div class="modal fade" id="new_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 100%; height: auto">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">新增考试</h4>
            </div>
            <form class="form-horizontal adminex-form" id="new_form" action="javascript: add_test()" >
                <div class="modal-body">
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">ID</label>
                        <div class="col-sm-6">
                            <input class="form-control id" name="id" type="text" placeholder="id" disabled />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">标题</label>
                        <div class="col-sm-6">
                            <input class="form-control title" name="title" type="text" placeholder="请输入标题" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">总分</label>
                        <div class="col-sm-6">
                            <input class="form-control count" name="count" type="text" placeholder="请输入总分" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">考试时长</label>
                        <div class="col-sm-6">
                            <input class="form-control gtime" name="gtime" type="text" placeholder="请输入时长" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">开始时间</label>
                        <div class="col-sm-6">
                            <input class="form-control time" name="time" type="date" placeholder="请输入开始时间" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 col-sm-offset-1 control-label">结束时间</label>
                        <div class="col-sm-6">
                            <input class="form-control data" name="data" type="date" placeholder="请输入结束时间" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <input type="submit" class="btn btn-primary" value="保存" />
                </div>
            </form>

        </div>
    </div>
</div>
<!-- loading Modal start-->
<div class="modal fade" id="loadingModal" data-backdrop="static">
    <div style="width: 200px;height:20px; z-index: 20000; position: absolute; text-align: center; left: 50%; top: 50%;margin-left:-100px;margin-top:-10px">
        <div class="progress progress-striped active" style="margin-bottom: 0;">
            <div class="progress-bar" style="width: 100%;"></div>
        </div>
        <h5 style="color: white; font-weight: bold">努力加载中...</h5>
    </div>
</div>


</body>
<script src="../node_modules/echarts/dist/echarts.common.js" ></script>
<script src="../node_modules/jquery/dist/jquery.min.js" ></script>
<script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="../package/bootstrapvalidator-master/dist/js/bootstrapValidator.min.js" ></script>
<script src="../js/public.js" ></script>
<script src="../package/jquerypage.js" ></script>
<!-- 分页器 -->
<script src="../lib/bootstrap-paginator.js"></script>
<!-- 提示框插件 -->
<script src="../lib/toastr/toastr.min.js"></script>
<!-- 对话框样式 -->
<script src="../lib/confirm/jquery-confirm.min.js"></script>
<!-- 课程图片上传 -->
<script src="../js/course_img.js"></script>
<!--<script src="../js/course_announcement.js"></script>-->
<script type="text/javascript">
    var pageNum = 1
    $(function(){
        // 模态框居中
        modalCenter('#myModal')
        modalCenter('#myModal1')

        $(".tcdPageCode").createPage({
            pageCount:20,
            current:1,
            backFn:function(p){
                console.log(p);
            }
        });
        select_test(pageNum)

        $(".tt_content_right").on("click",".addexamin",function(){
            var exaid = $(this).data("exaid");
            console.log(cid,exaid);
            // 当测试页面时为1,考试页面为2
            window.location.href = "addexamination.html?exaid="+exaid+"&sta="+2+"&cid="+cid
        })
    })
    // 查询
    function select_test(pageN) {
        var param = {
            cid: 1,
            page: pageN,
        }

        // loading显示
        $("#loadingModal").modal("show")
        var TestAjax = $.ajax({
            url: HTTP_URL + "Test/set_exam",
            type: "get",
            timeout: 5000,
            dataType: "json",
            // async:false,    //不进行异步刷新
            data: param,
            success: function (data) {
                console.log(data)
                var res = ""
                var dat = data[0]
                if ("" == dat) {
                    // 没有数据，显示提示
                    // toastr.error("未查询到可用数据")
                    $("#loadingModal").modal("hide")
                    $(".no_data_tea").show()
                    $('.announcement_content').html(res)
                } else {
                    for (var i in dat) {
                        var item = dat[i]
                        // console.log(item)
                        var index = +i+1
                        // 时间戳转换
                        res += '<div class="announcement_information">\n' +
                            '                    <div class="announcement_btn">\n' +
                            // '                        <button data-exaid="'+ item.id +'" class="addexamin">添加试卷题目</button>\n'+    
                            // '                        <span>|</span>\n' +
                            (item.state == 1 ? "" : '<button data-exaid="'+ item.id +'" class="addexamin">添加试卷题目</button>\n<span>|</span>\n')+
                            '                        <button onclick="test_detail(' + JSON.stringify(item).replace(/"/g, "&quot;") + ')">编辑</button>\n' +
                            '                        <span>|</span>\n' +
                            '                        <button onclick="delete_test('+ item.id +')">删除</button>\n' +
                            '                    </div>\n' +
                            '                    <div class="announcement_text">\n' +
                            '                        <p>'+ index +'、'+ item.name +'</p>\n' +
                            '                        <p>考试总分： '+ item.count +'分</p>\n' +
                            '                        <p>考试规定时间： '+ item.gtime +'分钟</p>\n' +
                            '                        <p>考试起止日期： <span class="announcement_text_content">'+ item.time +' / '+ item.data +'</span></p>\n' +
                            '                    </div>\n' +
                            '                </div>'
                    }

                    $('.announcement_content').html(res)
                    //分页
                    $("#page").bootstrapPaginator({
                        bootstrapMajorVersion: 3,   //bootstrap版本
                        totalPages: data[1],   //总页数
                        currentPage: pageN,  //当前页数
                        numberOfPages: 3,    //分页器每页展示页码数
                        shouldShowPage: true,   //所有的按钮都展示
                        itemTexts: function (type, page, current) {
                            // console.log(type)
                            //设置分页控件每部分的显示文字
                            switch (type) {
                                case "first":
                                    return "第一页"
                                case "prev":
                                    return "上一页"
                                case "next":
                                    return "下一页"
                                case "last":
                                    return "最后一页"
                                case "page":
                                    return page
                                case "jump":
                                    return "跳转"
                            }
                        }, onPageClicked: function(event, originalEvent, type, page) {
                            //点击事件
                            //page表示分页控件当前的页码，用这个页码重新走网络请求，会拿到对应的数据
                            pageNum = page
                            // 查询
                            select_test(pageNum)
                        }
                    })
                    //  分页结束
                }

            },
            error: function (e) {
                console.log(e)
                if ("timeout" == e.statusText) {
                    // 请求超时，终止请求
                    toastr.warning("请求超时")
                    TestAjax.abort()
                } else {
                    toastr.error("网络开小猜了，请稍后再试！")
                }
                // $("#loadingModal").modal("hide")
            },
            complete: function (xhr, status) {
                // 隐藏loading
                $("#loadingModal").modal("hide")
            }
        })
    }

    // 编辑修改
    function test_detail(item) {
        $("#detail_modal .id").val(item.id)
        $("#detail_modal .title").val(item.name)
        $("#detail_modal .count").val(item.count)
        $("#detail_modal .gtime").val(item.gtime)
        $("#detail_modal .time").val(item.time)
        $("#detail_modal .data").val(item.data)
        // 显示模态框
        $("#detail_modal").modal("show")
    }
    function update_test() {
        // 隐藏详情模态框
        $("#detail_modal").modal("hide")
        $("#loadingModal").modal("show")
        // 获取模态框中输入的值
        var id = $("#detail_modal .id").val()
        var title = $("#detail_modal .title").val()
        var count = $("#detail_modal .count").val()
        var gtime = $("#detail_modal .gtime").val()
        var time = $("#detail_modal .time").val()
        var data = $("#detail_modal .data").val()
        //  修改信息网络请求
        var UpdateTestAjax = $.ajax({
            url: HTTP_URL + "Test/upexam",
            type: "post",
            data: {
                id: id,
                name: title,
                count: count,
                gtime: gtime,
                time: time,
                data: data,
            },
            dataType: "json",
            success: function (data) {
                toastr.success("操作成功！")
                select_test(pageNum)
            },
            error: function (e) {
                toastr.error("网络开小猜了，请稍后再试！")
                console.log(e)
            },
            complete: function (xhr, status) {
                // 隐藏loading
                $("#loadingModal").modal("hide")
            }
        })
    }

    // 新增
    function new_detail() {
        $("#new_modal").modal("show")
    }
    function add_test() {
        // 隐藏详情模态框
        $("#new_modal").modal("hide")
        $("#loadingModal").modal("show")
        // 获取模态框中输入的值
        var id = $("#new_modal .id").val()
        var title = $("#new_modal .title").val()
        var count = $("#new_modal .count").val()
        var gtime = $("#new_modal .gtime").val()
        var time = $("#new_modal .time").val()
        var data = $("#new_modal .data").val()

        var AddTestAjax = $.ajax({
            url: HTTP_URL + "Test/exam",
            type: "post",
            data: {
                cid: cid,
                name: title,
                count: count,
                gtime: gtime,
                time: time,
                data: data,
            },
            dataType: "json",
            success: function (data) {
                toastr.success("操作成功！")
                // 成功后把模态框中的内容清空
                $("#new_modal .modal-body input").each(function () {
                    // jquery 遍历节点 $(this)指每次遍历拿到的元素
                    $(this).val("") // 清空值
                })
                select_test(pageNum)
            },
            error: function (e) {
                toastr.error("网络开小猜了，请稍后再试！")
                console.log(e)
            },
            complete: function (xhr, status) {
                // 隐藏loading
                $("#loadingModal").modal("hide")
            }
        })
    }

    // 删除
    function delete_test(id) {
        confirmBySelf("确认删除吗？", function () {
            // 用户点击确认时
            $("#loadingModal").modal("show")
            var UpdateTeacherAjax = $.ajax({
                url: HTTP_URL + "Test/deexam",
                type: "post",
                data: {
                    id: id
                },
                dataType: "json",
                success: function (data) {
                    toastr.success("操作成功！")
                    select_test(pageNum)
                },
                error: function (e) {
                    console.log(e)
                },
                complete: function (xhr, status) {
                    // 隐藏loading
                    $("#loadingModal").modal("hide")
                }
            })
        })
    }

    //提示框初始化，toast-top-center表示提示框的位置
    toastr.options = {
        positionClass: 'toast-top-center', // 提示框位置
        closeButton: true  // 是否显示关闭按钮
    }
    // 时间戳
    function formatDate(now) {
        var year=now.getFullYear();
        var month=now.getMonth()+1;
        var date=now.getDate();
        var hour=now.getHours();
        var minute=now.getMinutes();
        var second=now.getSeconds();
        return year+"-"+month+"-"+date;
    }
    /**
     *对话框
     * @param content  提示内容
     * @param func      点击对话框确认按钮做什么，类型为function
     */
    function confirmBySelf(content, func) {
        $.confirm({
            confirmButtonClass: "btn-primary",   //设置ok按钮样式
            closeIcon: true,        //对话框右上角关闭
            confirmButton: "确认", //确认按钮标题
            cancelButton: "取消", //取消按钮标题
            title: "提示",        //标题
            content: content,        //对话内容
            confirm: function () {
                //点击确认后做什么
                func()
            },
            cancel:function () {
                //点击取消后做什么
            }
        })
    }

</script>

</html>

